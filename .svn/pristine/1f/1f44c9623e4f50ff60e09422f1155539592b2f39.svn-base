/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package test;

import com.sun.xml.rpc.processor.modeler.j2ee.xml.javaIdentifierType;
import cr.cdrb.commons.crypt.PublicKeyCrypt;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.net.URL;
import java.util.Properties;
import org.apache.xmlbeans.impl.store.Path;
import org.junit.Test;
import static org.junit.Assert.*;

/**
 *
 * @author Administrator
 */
public class AESCryptTest {
   
    public AESCryptTest() {
    }
    
    @Test
    public void TestAES() {
        String content = "Hello, World!";
        String key = "SomeKey";
        String encode = PublicKeyCrypt.encryptAES(content, key);
        String decode = PublicKeyCrypt.decryptAES(encode, key);
        assertEquals(decode, content);
    }
    
    @Test
    public void TestCryptJdbc() throws Exception {
        Properties prop = new Properties();
        String base_dir = System.getProperty("user.dir");
        String path_from = base_dir + "\\src\\test\\java\\test\\jdbc.properties";
        String path_to = base_dir + "\\src\\main\\webapp\\WEB-INF\\jdbc.properties";
        try (InputStream ins = new FileInputStream(path_from)) {
            prop.load(ins);
        }
        prop.stringPropertyNames().stream().forEach((key) -> {
            String value = prop.getProperty(key, "");
            prop.setProperty(key, PublicKeyCrypt.encryptAES(value, key));
        });
        try (FileOutputStream os = new FileOutputStream(path_to)) {
            prop.store(os, null);
        }
    }
    
    @Test
    public void TestDecryptJdbc() throws Exception {
        Properties prop = new Properties();
        String base_dir = System.getProperty("user.dir");
        String path1 = base_dir + "\\src\\main\\webapp\\WEB-INF\\jdbc1.properties";
        //String path2 = base_dir + "\\src\\main\\webapp\\WEB-INF\\jdbc2.properties";
        try (InputStream ins = new FileInputStream(path1)) {
            prop.load(ins);
        }
        prop.stringPropertyNames().stream().forEach((key) -> {
            String value = prop.getProperty(key, "");
            prop.setProperty(key, PublicKeyCrypt.decryptAES(value, key));
        }); 
        //try (FileOutputStream os = new FileOutputStream(path2)) {
        //    prop.store(os, null);
        //}
    }

}
