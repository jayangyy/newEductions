/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package cr.cdrb.web.edu.services;

import cr.cdrb.web.edu.daointerface.IUserdao;
import cr.cdrb.web.edu.iservices.IUserService;
import cr.cdrb.web.edu.security.domains.EduUser;
import java.sql.SQLException;
import javax.servlet.http.HttpSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.context.SecurityContext;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Service;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.SessionAttributes;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

/**
 *
 * @author Jayang 用户
 */
@Service
@SessionAttributes("eduuser")
public class UsersService implements IUserService {

    @Autowired
    private IUserdao userDao;

    @Override
    public EduUser GetEduUser(String username) throws SQLException {
        return userDao.GetEduUser(username);
    }

    public static EduUser GetCurrentUser() {
        HttpSession session = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest().getSession();
        return session.getAttribute("SPRING_SECURITY_CONTEXT") != null ? (EduUser)(((SecurityContext) session.getAttribute("SPRING_SECURITY_CONTEXT")).getAuthentication().getPrincipal()) : null;
    }
}
